<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmileCare Dashboard</title>
  <link rel="stylesheet" href="Staff-1.css">
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"/>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="logo_content">
    <div class="logo">
      <img src="SmileCareLogo Dashboard.png" alt="SmileCare Logo">
      <div class="logo_name">SmileCare</div>
    </div>
    <i class="ri-menu-line" id="btn"></i>
  </div>

  <ul class="nav_list">
    <li><a href="#" onclick="showSection('dashboard')"><i class="ri-dashboard-line"></i><span class="links_name">Dashboard</span></a></li>
    <li><a href="#" onclick="showSection('patient')"><i class="ri-user-line"></i><span class="links_name">Patient</span></a></li>
    <li><a href="#" onclick="showSection('appointment_table')"><i class="ri-calendar-2-line"></i><span class="links_name">Appointment</span></a></li>
    <li class="logout"><a href="Home.html"><i class="ri-logout-box-line"></i><span class="links_name">Logout</span></a></li>
  </ul>
</div>

<!-- Main Content -->
<div class="home_content">

  <!-- Dashboard Section -->
  <div id="dashboard" class="content_section">
    <div class="text-container">
      <div class="home_text">
        <div class="text-1">Welcome Username!</div>
        <div class="text-2">Providing exceptional care and making smiles brighter every day</div>
      </div>
    </div>
  </div>

<!-- Patient Section -->
<div id="patient" class="table content_section" style="display:none;">
  <main class="table" id="patient_table">
    <section class="table__header">
      <h1>Patient Details</h1>
    </section>
    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th> ID </th>
            <th> Patient Name </th>
            <th> Date of Birth </th>
            <th> Gender </th>
          </tr>
        </thead>
        <tbody id="patient-table-body">
          <!-- Booking Rows will be inserted here by JavaScript -->
        </tbody>
      </table>
    </section>
  </main>
</div>

<!-- Appointment Section -->
<div id="appointment_table" class="table content_section" style="display:none;">
  <main class="table">
    <section class="table__header">
      <h1>Appointment</h1>
    </section>
    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th> ID </th>
            <th> Patient Name </th>
            <th> Date of Birth </th>
            <th> Gender </th>
            <th> Day & Time </th>
            <th> Treatment </th>
          </tr>
        </thead>
        <tbody id="appointment-table-body">
          <!-- Appointment Rows will be inserted here by JavaScript -->
        </tbody>
      </table>
    </section>
  </main>
</div>

<script>
const btn = document.querySelector("#btn");
const sidebar = document.querySelector(".sidebar");

btn.onclick = function () {
  sidebar.classList.toggle("active");
};

function showSection(sectionId) {
  document.querySelectorAll('.content_section').forEach(sec => sec.style.display = 'none');
  document.getElementById(sectionId).style.display = '';
  if (sectionId === 'patient') loadPatientTable();
  if (sectionId === 'appointment_table') loadAppointmentTable();
}

function setupTableFeatures(tableId) {
  const table = document.querySelector(#${tableId});
  if (!table) return;
  const rows = table.querySelectorAll('tbody tr');
  const headings = table.querySelectorAll('thead th');
  const originalOrder = Array.from(rows);
  headings.forEach((head, i) => {
    let sortAsc = true;
    head.onclick = () => {
      headings.forEach(h => h.classList.remove('active'));
      head.classList.add('active');
      table.querySelectorAll('tbody td').forEach(td => td.classList.remove('active'));
      rows.forEach(row => row.querySelectorAll('td')[i].classList.add('active'));
      sortAsc = head.classList.contains('asc') ? false : true;
      head.classList.toggle('asc', sortAsc);
      const sortedRows = [...rows].sort((a, b) => {
        const aText = a.querySelectorAll('td')[i].textContent.toLowerCase();
        const bText = b.querySelectorAll('td')[i].textContent.toLowerCase();
        return sortAsc ? aText.localeCompare(bText) : bText.localeCompare(aText);
      });
      sortedRows.forEach(row => table.querySelector('tbody').appendChild(row));
    };
  });
  document.addEventListener('click', function (event) {
    const isClickInside = table.contains(event.target);
    if (!isClickInside) {
      table.querySelectorAll('thead th.active').forEach(th => th.classList.remove('active'));
      table.querySelectorAll('tbody td.active').forEach(td => td.classList.remove('active'));
      const tbody = table.querySelector('tbody');
      originalOrder.forEach(row => tbody.appendChild(row));
    }
  });
}

// Load only ID, Patient Name, Date of Birth, Gender for patient table
async function loadPatientTable() {
  try {
    const response = await fetch('http://localhost:3002/bookings', { credentials: 'include' });
    const bookings = await response.json();
    const tbody = document.getElementById('patient-table-body');
    tbody.innerHTML = '';
    bookings.forEach(booking => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${booking.id}</td>
        <td>${booking.name}</td>
        <td>${booking.dateOfBirth}</td>
        <td>${booking.gender}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    alert('Failed to load patient data.');
  }
}

// Load all columns for appointment table
async function loadAppointmentTable() {
  try {
    const response = await fetch('http://localhost:3002/bookings', { credentials: 'include' });
    const bookings = await response.json();
    const tbody = document.getElementById('appointment-table-body');
    tbody.innerHTML = '';
    bookings.forEach(booking => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${booking.id}</td>
        <td>${booking.name}</td>
        <td>${booking.dateOfBirth}</td>
        <td>${booking.gender}</td>
        <td>${booking.dateTime}</td>
        <td>${booking.treatment}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    alert('Failed to load appointment data.');
  }
}

// Optionally, load dashboard by default
showSection('dashboard');
</script>

</body>
</html>
